# Архитектура

## Принципы
- Чёткое разделение слоёв: UI (components/pages), домен (modules), сервисы (services), инфраструктура (utils/styles).
- Строгий TypeScript, отсутствие `any`.
- Переиспользуемые чистые функции и утилиты вместо бизнес-логики в компонентах.
- API-слой инкапсулирует работу с Gemini и выдаёт структурированные типы.
- UI основан на Chakra UI с единой темой и адаптивностью.

## Структура каталогов
- `src/components` — атомарные блоки UI (layout, inputs, feedback, display).
- `src/pages` — страницы приложения (точки композиции компонентов).
- `src/modules` — доменные модули (промпты, история запросов, константы и типы домена).
- `src/services` — внешний API-клиент Gemini.
- `src/hooks` — кастомные хуки (например, работа с LocalStorage историей).
- `src/utils` — обработчики ошибок, парсеры Markdown, вспомогательные функции.
- `src/styles` — тема Chakra и глобальные стили Markdown.
- `src/types` — общие типы запросов/ответов.

## Потоки данных
1. `RequestForm` собирает `GenerationRequest` и передаёт в `App`.
2. `App` вызывает `GeminiService.generateVpnPlan`, обрабатывает ошибки через `handleError` и обновляет состояние.
3. Ответ преобразуется `formatSections` в структурированные секции и сохраняется в историю через `useRequestHistory` (LocalStorage).
4. UI рендерит `ResponseViewer`, `HistoryDrawer`, состояния загрузки/ошибок и уведомления toast.

## Обработка ошибок
- Кастомный `AppError` и `handleError` централизуют сообщения для пользователей.
- Сервис кидает ошибки при отсутствии API-ключа или пустом ответе.

## Стейт
- Локальный стейт в `App` минимален: загрузка, ошибка, секции, сырое тело.
- История хранится в LocalStorage, ограничена 50 записями.

## Стили
- Темизация через Chakra (`styles/theme.ts`), глобальные стили для Markdown и кода.
- Цветовая схема по умолчанию — тёмная, цвет акцента cyan.
